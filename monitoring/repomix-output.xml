This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
grafana/
  dashboards/
    code-complexity.json
    tcad-overview.json
  provisioning/
    dashboards/
      dashboard-provider.yml
    datasources/
      prometheus.yml
prometheus/
  prometheus.rules.yml
  prometheus.yml
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="grafana/dashboards/code-complexity.json">
{
  "dashboard": {
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": "-- Grafana --",
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 15
                },
                {
                  "color": "red",
                  "value": 20
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 0,
          "y": 0
        },
        "id": 1,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_cyclomatic",
            "refId": "A"
          }
        ],
        "title": "Average Cyclomatic Complexity",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 6,
          "y": 0
        },
        "id": 2,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_lines",
            "refId": "A"
          }
        ],
        "title": "Total Lines of Code",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 12,
          "y": 0
        },
        "id": 3,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_files",
            "refId": "A"
          }
        ],
        "title": "Total Files",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 250
                },
                {
                  "color": "red",
                  "value": 400
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 18,
          "y": 0
        },
        "id": 4,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_max_function_lines",
            "refId": "A"
          }
        ],
        "title": "Largest Function (Lines)",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "Lines of Code",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              },
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 9,
          "w": 24,
          "x": 0,
          "y": 8
        },
        "id": 5,
        "options": {
          "legend": {
            "calcs": ["mean", "last"],
            "displayMode": "table",
            "placement": "right"
          },
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_lines",
            "legendFormat": "Total Lines",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_code_lines",
            "legendFormat": "Code Lines",
            "refId": "B"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_comment_lines",
            "legendFormat": "Comment Lines",
            "refId": "C"
          }
        ],
        "title": "Code Growth Over Time",
        "type": "timeseries"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "Complexity",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              },
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 17
        },
        "id": 6,
        "options": {
          "legend": {
            "calcs": ["mean", "last"],
            "displayMode": "table",
            "placement": "bottom"
          },
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_cyclomatic",
            "legendFormat": "Avg Cyclomatic",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_max_cyclomatic",
            "legendFormat": "Max Cyclomatic",
            "refId": "B"
          }
        ],
        "title": "Cyclomatic Complexity Trend",
        "type": "timeseries"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "Count",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              },
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 17
        },
        "id": 7,
        "options": {
          "legend": {
            "calcs": ["mean", "last"],
            "displayMode": "table",
            "placement": "bottom"
          },
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_files",
            "legendFormat": "Total Files",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_functions",
            "legendFormat": "Total Functions",
            "refId": "B"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_code_complexity_total_classes",
            "legendFormat": "Total Classes",
            "refId": "C"
          }
        ],
        "title": "Codebase Structure",
        "type": "timeseries"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "displayMode": "auto"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 250
                },
                {
                  "color": "red",
                  "value": 400
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 26
        },
        "id": 8,
        "options": {
          "showHeader": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "topk(10, tcad_scraper_code_complexity_file_lines)",
            "format": "table",
            "refId": "A"
          }
        ],
        "title": "Largest Files (Top 10)",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "Value": "Lines",
                "file": "File Path"
              }
            }
          }
        ],
        "type": "table"
      }
    ],
    "refresh": "1m",
    "schemaVersion": 36,
    "style": "dark",
    "tags": ["tcad-scraper", "code-quality", "complexity"],
    "templating": {
      "list": []
    },
    "time": {
      "from": "now-7d",
      "to": "now"
    },
    "timepicker": {},
    "timezone": "",
    "title": "TCAD Scraper - Code Complexity",
    "uid": "tcad-code-complexity",
    "version": 1,
    "weekStart": ""
  }
}
</file>

<file path="grafana/dashboards/tcad-overview.json">
{
  "dashboard": {
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": "-- Grafana --",
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 1,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
      {
        "datasource": "Prometheus",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 0
        },
        "id": 1,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true,
          "text": {}
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "rate(tcad_scraper_http_requests_total[5m]) * 60",
            "refId": "A"
          }
        ],
        "title": "HTTP Requests per Minute",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percent"
          }
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 0
        },
        "id": 2,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "sum(rate(tcad_scraper_http_requests_total{status_code=~\"2..\"}[5m])) / sum(rate(tcad_scraper_http_requests_total[5m])) * 100",
            "refId": "A"
          }
        ],
        "title": "HTTP Success Rate",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              },
              "lineInterpolation": "linear",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "s"
          }
        },
        "gridPos": {
          "h": 9,
          "w": 24,
          "x": 0,
          "y": 8
        },
        "id": 3,
        "options": {
          "legend": {
            "calcs": ["mean", "max"],
            "displayMode": "table",
            "placement": "right"
          },
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "histogram_quantile(0.50, sum(rate(tcad_scraper_http_request_duration_seconds_bucket[5m])) by (le, route))",
            "legendFormat": "p50 - {{route}}",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "histogram_quantile(0.95, sum(rate(tcad_scraper_http_request_duration_seconds_bucket[5m])) by (le, route))",
            "legendFormat": "p95 - {{route}}",
            "refId": "B"
          },
          {
            "datasource": "Prometheus",
            "expr": "histogram_quantile(0.99, sum(rate(tcad_scraper_http_request_duration_seconds_bucket[5m])) by (le, route))",
            "legendFormat": "p99 - {{route}}",
            "refId": "C"
          }
        ],
        "title": "HTTP Response Time Percentiles by Route",
        "type": "timeseries"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "Jobs/sec",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 20,
              "gradientMode": "none",
              "hideFrom": {
                "tooltip": false,
                "viz": false,
                "legend": false
              },
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "normal"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 0,
          "y": 17
        },
        "id": 4,
        "options": {
          "legend": {
            "calcs": ["mean", "last"],
            "displayMode": "table",
            "placement": "bottom"
          },
          "tooltip": {
            "mode": "multi",
            "sort": "none"
          }
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "rate(tcad_scraper_jobs_total{status=\"completed\"}[5m])",
            "legendFormat": "Completed",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "rate(tcad_scraper_jobs_total{status=\"failed\"}[5m])",
            "legendFormat": "Failed",
            "refId": "B"
          }
        ],
        "title": "Scrape Job Rate by Status",
        "type": "timeseries"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 50
                },
                {
                  "color": "red",
                  "value": 100
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 9,
          "w": 12,
          "x": 12,
          "y": 17
        },
        "id": 5,
        "options": {
          "displayMode": "lcd",
          "orientation": "horizontal",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showUnfilled": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_queue_size{status=\"waiting\"}",
            "legendFormat": "Waiting",
            "refId": "A"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_active_jobs",
            "legendFormat": "Active",
            "refId": "B"
          },
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_queue_size{status=\"failed\"}",
            "legendFormat": "Failed",
            "refId": "C"
          }
        ],
        "title": "Queue Status",
        "type": "bargauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "red",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 50
                },
                {
                  "color": "green",
                  "value": 70
                }
              ]
            },
            "unit": "percent"
          }
        },
        "gridPos": {
          "h": 6,
          "w": 6,
          "x": 0,
          "y": 26
        },
        "id": 6,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_cache_hit_rate",
            "refId": "A"
          }
        ],
        "title": "Cache Hit Rate",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 1000
                },
                {
                  "color": "red",
                  "value": 3600
                }
              ]
            },
            "unit": "s"
          }
        },
        "gridPos": {
          "h": 6,
          "w": 6,
          "x": 6,
          "y": 26
        },
        "id": 7,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "tcad_scraper_token_age_seconds",
            "refId": "A"
          }
        ],
        "title": "TCAD Token Age",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 70
                },
                {
                  "color": "red",
                  "value": 85
                }
              ]
            },
            "unit": "percent"
          }
        },
        "gridPos": {
          "h": 6,
          "w": 6,
          "x": 12,
          "y": 26
        },
        "id": 8,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "(nodejs_heap_size_used_bytes / nodejs_heap_size_total_bytes) * 100",
            "refId": "A"
          }
        ],
        "title": "Node.js Heap Usage",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "yellow",
                  "value": 0.1
                },
                {
                  "color": "red",
                  "value": 1
                }
              ]
            },
            "unit": "s"
          }
        },
        "gridPos": {
          "h": 6,
          "w": 6,
          "x": 18,
          "y": 26
        },
        "id": 9,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": ["lastNotNull"],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.0.0",
        "targets": [
          {
            "datasource": "Prometheus",
            "expr": "nodejs_eventloop_lag_seconds",
            "refId": "A"
          }
        ],
        "title": "Event Loop Lag",
        "type": "gauge"
      }
    ],
    "refresh": "10s",
    "schemaVersion": 36,
    "style": "dark",
    "tags": ["tcad-scraper", "overview"],
    "templating": {
      "list": []
    },
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "timepicker": {},
    "timezone": "",
    "title": "TCAD Scraper - Overview",
    "uid": "tcad-overview",
    "version": 1,
    "weekStart": ""
  }
}
</file>

<file path="grafana/provisioning/dashboards/dashboard-provider.yml">
# Grafana Dashboard Provisioning
# Auto-loads dashboard JSON files on Grafana startup

apiVersion: 1

providers:
  # TCAD Scraper dashboards
  - name: 'TCAD Scraper Dashboards'
    orgId: 1
    folder: 'TCAD Scraper'
    type: file
    disableDeletion: false
    updateIntervalSeconds: 30
    allowUiUpdates: true
    options:
      path: /var/lib/grafana/dashboards
      foldersFromFilesStructure: true
</file>

<file path="grafana/provisioning/datasources/prometheus.yml">
# Grafana Datasource Provisioning
# Auto-configures Prometheus datasource on Grafana startup

apiVersion: 1

datasources:
  # Prometheus datasource for TCAD Scraper metrics
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: true
    jsonData:
      timeInterval: "15s"
      queryTimeout: "300s"
      httpMethod: "POST"
      # Enable Prometheus exemplars support
      exemplarTraceIdDestinations:
        - name: trace_id
          datasourceUid: tempo  # If using Tempo for tracing
    version: 1
</file>

<file path="prometheus/prometheus.rules.yml">
# Prometheus Alerting Rules for TCAD Scraper
# Configurable thresholds for production monitoring

groups:
  # ===========================================================================
  # Application Health Alerts
  # ===========================================================================
  - name: application_health
    interval: 30s
    rules:
      # High HTTP error rate (5xx errors)
      - alert: HighServerErrorRate
        expr: |
          (
            sum(rate(tcad_scraper_http_requests_total{status_code=~"5.."}[5m]))
            /
            sum(rate(tcad_scraper_http_requests_total[5m]))
          ) > 0.05
        for: 5m
        labels:
          severity: critical
          component: http
        annotations:
          summary: "High server error rate detected"
          description: "Server error rate is {{ $value | humanizePercentage }} (threshold: 5%)"
          dashboard: "http://localhost:3000/d/tcad-overview"

      # High HTTP client error rate (4xx errors)
      - alert: HighClientErrorRate
        expr: |
          (
            sum(rate(tcad_scraper_http_requests_total{status_code=~"4.."}[5m]))
            /
            sum(rate(tcad_scraper_http_requests_total[5m]))
          ) > 0.20
        for: 10m
        labels:
          severity: warning
          component: http
        annotations:
          summary: "High client error rate detected"
          description: "Client error rate is {{ $value | humanizePercentage }} (threshold: 20%)"

      # Slow HTTP response times
      - alert: SlowHttpResponses
        expr: |
          histogram_quantile(0.95,
            sum(rate(tcad_scraper_http_request_duration_seconds_bucket[5m])) by (le, route)
          ) > 3
        for: 10m
        labels:
          severity: warning
          component: http
        annotations:
          summary: "Slow HTTP responses on {{ $labels.route }}"
          description: "95th percentile response time is {{ $value }}s (threshold: 3s)"

  # ===========================================================================
  # Scraper Performance Alerts
  # ===========================================================================
  - name: scraper_performance
    interval: 30s
    rules:
      # High scrape job failure rate
      - alert: HighScrapeFailureRate
        expr: |
          (
            sum(rate(tcad_scraper_jobs_total{status="failed"}[10m]))
            /
            sum(rate(tcad_scraper_jobs_total[10m]))
          ) > 0.20
        for: 5m
        labels:
          severity: critical
          component: scraper
        annotations:
          summary: "High scrape job failure rate"
          description: "Failure rate is {{ $value | humanizePercentage }} (threshold: 20%)"
          runbook: "Check TCAD website availability and authentication tokens"

      # Scraper jobs taking too long
      - alert: SlowScrapeJobs
        expr: |
          histogram_quantile(0.95,
            sum(rate(tcad_scraper_job_duration_seconds_bucket[10m])) by (le)
          ) > 300
        for: 15m
        labels:
          severity: warning
          component: scraper
        annotations:
          summary: "Scrape jobs are taking too long"
          description: "95th percentile job duration is {{ $value }}s (threshold: 300s)"

      # No scraping activity
      - alert: NoScrapingActivity
        expr: |
          rate(tcad_scraper_jobs_total[15m]) == 0
        for: 30m
        labels:
          severity: warning
          component: scraper
        annotations:
          summary: "No scraping activity detected"
          description: "No scrape jobs have been processed in the last 15 minutes"

  # ===========================================================================
  # Queue Health Alerts
  # ===========================================================================
  - name: queue_health
    interval: 30s
    rules:
      # Queue backing up
      - alert: QueueBackingUp
        expr: tcad_scraper_queue_size{status="waiting"} > 100
        for: 10m
        labels:
          severity: warning
          component: queue
        annotations:
          summary: "Job queue is backing up"
          description: "{{ $value }} jobs waiting in queue (threshold: 100)"
          action: "Consider scaling up workers or investigating slow jobs"

      # Queue critically backed up
      - alert: QueueCriticallyBackedUp
        expr: tcad_scraper_queue_size{status="waiting"} > 500
        for: 5m
        labels:
          severity: critical
          component: queue
        annotations:
          summary: "Job queue critically backed up"
          description: "{{ $value }} jobs waiting in queue (threshold: 500)"
          action: "URGENT: Scale up workers immediately"

      # Too many failed jobs
      - alert: HighFailedJobCount
        expr: tcad_scraper_queue_size{status="failed"} > 50
        for: 15m
        labels:
          severity: warning
          component: queue
        annotations:
          summary: "High number of failed jobs"
          description: "{{ $value }} failed jobs in queue (threshold: 50)"

  # ===========================================================================
  # Database Performance Alerts
  # ===========================================================================
  - name: database_performance
    interval: 30s
    rules:
      # Slow database queries
      - alert: SlowDatabaseQueries
        expr: |
          histogram_quantile(0.95,
            sum(rate(tcad_scraper_db_query_duration_seconds_bucket[5m])) by (le, operation)
          ) > 2
        for: 10m
        labels:
          severity: warning
          component: database
        annotations:
          summary: "Slow database queries detected"
          description: "95th percentile query time for {{ $labels.operation }} is {{ $value }}s (threshold: 2s)"
          action: "Review query performance and indexes"

      # High database error rate
      - alert: HighDatabaseErrorRate
        expr: |
          (
            sum(rate(tcad_scraper_db_queries_total{status="error"}[5m]))
            /
            sum(rate(tcad_scraper_db_queries_total[5m]))
          ) > 0.05
        for: 5m
        labels:
          severity: critical
          component: database
        annotations:
          summary: "High database error rate"
          description: "Database error rate is {{ $value | humanizePercentage }} (threshold: 5%)"

  # ===========================================================================
  # Cache Performance Alerts
  # ===========================================================================
  - name: cache_performance
    interval: 30s
    rules:
      # Low cache hit rate
      - alert: LowCacheHitRate
        expr: tcad_scraper_cache_hit_rate < 50
        for: 15m
        labels:
          severity: warning
          component: cache
        annotations:
          summary: "Low cache hit rate"
          description: "Cache hit rate is {{ $value }}% (threshold: 50%)"
          action: "Review cache TTL settings and usage patterns"

      # Cache critically unhealthy
      - alert: CacheCriticallyUnhealthy
        expr: tcad_scraper_cache_hit_rate < 20
        for: 10m
        labels:
          severity: critical
          component: cache
        annotations:
          summary: "Cache critically unhealthy"
          description: "Cache hit rate is {{ $value }}% (threshold: 20%)"
          action: "URGENT: Check Redis connectivity and health"

  # ===========================================================================
  # External Service Alerts
  # ===========================================================================
  - name: external_services
    interval: 30s
    rules:
      # Token refresh failures
      - alert: TokenRefreshFailures
        expr: rate(tcad_scraper_token_refresh_total{status="failure"}[10m]) > 0
        for: 5m
        labels:
          severity: critical
          component: token-refresh
        annotations:
          summary: "TCAD token refresh failures detected"
          description: "Token refresh is failing - scraping will stop working"
          action: "URGENT: Check TCAD authentication and credentials"

      # Token is old
      - alert: TokenIsOld
        expr: tcad_scraper_token_age_seconds > 7200  # 2 hours
        for: 10m
        labels:
          severity: warning
          component: token-refresh
        annotations:
          summary: "TCAD authentication token is old"
          description: "Token age is {{ $value | humanizeDuration }}"
          action: "Check token refresh service health"

      # High Claude AI error rate
      - alert: HighClaudeErrorRate
        expr: |
          (
            sum(rate(tcad_scraper_claude_requests_total{status="error"}[5m]))
            /
            sum(rate(tcad_scraper_claude_requests_total[5m]))
          ) > 0.20
        for: 10m
        labels:
          severity: warning
          component: claude-ai
        annotations:
          summary: "High Claude AI error rate"
          description: "Claude AI error rate is {{ $value | humanizePercentage }}"

  # ===========================================================================
  # System Resource Alerts
  # ===========================================================================
  - name: system_resources
    interval: 30s
    rules:
      # High memory usage
      - alert: HighMemoryUsage
        expr: |
          (
            nodejs_heap_size_used_bytes
            /
            nodejs_heap_size_total_bytes
          ) > 0.90
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "High Node.js memory usage"
          description: "Heap usage is {{ $value | humanizePercentage }} (threshold: 90%)"
          action: "Check for memory leaks or increase heap size"

      # Event loop lag
      - alert: HighEventLoopLag
        expr: nodejs_eventloop_lag_seconds > 1
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "High Node.js event loop lag"
          description: "Event loop lag is {{ $value }}s (threshold: 1s)"
          action: "Check for blocking operations or CPU-intensive tasks"

  # ===========================================================================
  # Code Complexity Alerts (Will be added after implementing complexity metrics)
  # ===========================================================================
  - name: code_quality
    interval: 1h
    rules:
      # High cyclomatic complexity
      - alert: HighCyclomaticComplexity
        expr: tcad_scraper_code_complexity_cyclomatic > 20
        for: 1h
        labels:
          severity: info
          component: code-quality
        annotations:
          summary: "High cyclomatic complexity detected"
          description: "Average cyclomatic complexity is {{ $value }} (threshold: 20)"
          action: "Consider refactoring complex functions"

      # Technical debt increasing
      - alert: TechnicalDebtIncreasing
        expr: |
          delta(tcad_scraper_code_complexity_total_lines[24h]) > 1000
        for: 1h
        labels:
          severity: info
          component: code-quality
        annotations:
          summary: "Significant code growth detected"
          description: "Code base grew by {{ $value }} lines in 24 hours"
          action: "Review recent changes for code quality"
</file>

<file path="prometheus/prometheus.yml">
# Prometheus Configuration for TCAD Scraper
# Configurable and scalable monitoring setup

global:
  # How frequently to scrape targets
  scrape_interval: 15s
  # How frequently to evaluate rules
  evaluation_interval: 15s
  # Attach these labels to all time series
  external_labels:
    cluster: 'tcad-scraper'
    environment: 'production'

# Load and evaluate alerting rules
rule_files:
  - "prometheus.rules.yml"

# Scrape configurations
scrape_configs:
  # ===========================================================================
  # TCAD Scraper Application
  # ===========================================================================
  - job_name: 'tcad-scraper-app'
    # Scrape more frequently for application metrics
    scrape_interval: 10s
    scrape_timeout: 5s
    metrics_path: '/metrics'

    # Static targets - update for production deployment
    static_configs:
      - targets:
          # Docker host networking - adjust based on your setup
          - 'host.docker.internal:3002'  # macOS/Windows Docker Desktop
          # - 'tcad-scraper:3002'          # If app is in same Docker network
          # - 'localhost:3002'             # If running outside Docker
        labels:
          service: 'tcad-scraper'
          tier: 'application'

    # Relabel configs for dynamic service discovery (optional)
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - source_labels: [__scheme__]
        target_label: scheme

  # ===========================================================================
  # Prometheus Self-Monitoring
  # ===========================================================================
  - job_name: 'prometheus'
    scrape_interval: 30s
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          tier: 'monitoring'

  # ===========================================================================
  # Node Exporter - System Metrics
  # ===========================================================================
  - job_name: 'node-exporter'
    scrape_interval: 30s
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          service: 'node-exporter'
          tier: 'system'

  # ===========================================================================
  # cAdvisor - Container Metrics
  # ===========================================================================
  - job_name: 'cadvisor'
    scrape_interval: 30s
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          service: 'cadvisor'
          tier: 'containers'

  # ===========================================================================
  # PostgreSQL Exporter (Optional - uncomment if using)
  # ===========================================================================
  # - job_name: 'postgres-exporter'
  #   scrape_interval: 30s
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']
  #       labels:
  #         service: 'postgres-exporter'
  #         tier: 'database'

  # ===========================================================================
  # Redis Exporter (Optional - uncomment if using)
  # ===========================================================================
  # - job_name: 'redis-exporter'
  #   scrape_interval: 30s
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #       labels:
  #         service: 'redis-exporter'
  #         tier: 'cache'

# Remote write configuration for long-term storage (optional)
# remote_write:
#   - url: "https://your-remote-storage/api/v1/write"
#     basic_auth:
#       username: "user"
#       password: "pass"

# Remote read configuration (optional)
# remote_read:
#   - url: "https://your-remote-storage/api/v1/read"
</file>

<file path="README.md">
# Monitoring Configuration

This directory contains configuration files for the Prometheus/Grafana monitoring stack.

## Directory Structure

```
monitoring/
├── README.md (this file)
├── prometheus/
│   ├── prometheus.yml          # Main Prometheus configuration
│   └── prometheus.rules.yml    # Alerting rules
└── grafana/
    ├── provisioning/
    │   ├── datasources/        # Auto-configured data sources
    │   │   └── prometheus.yml
    │   └── dashboards/         # Dashboard provisioning
    │       └── dashboard-provider.yml
    └── dashboards/             # Pre-built dashboards
        ├── tcad-overview.json
        └── code-complexity.json
```

## Quick Start

```bash
# Start monitoring stack
docker-compose -f docker-compose.monitoring.yml up -d

# Check status
docker-compose -f docker-compose.monitoring.yml ps

# View logs
docker-compose -f docker-compose.monitoring.yml logs -f

# Stop monitoring stack
docker-compose -f docker-compose.monitoring.yml down
```

## Access Points

- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)
- **Node Exporter**: http://localhost:9100/metrics
- **cAdvisor**: http://localhost:8080

## Configuration Files

### Prometheus Configuration

**File**: `prometheus/prometheus.yml`

Defines:
- Scrape targets (what to monitor)
- Scrape intervals (how often)
- Alert rule files
- Global settings

**Modify for your environment:**

```yaml
scrape_configs:
  - job_name: 'tcad-scraper-app'
    static_configs:
      - targets:
          # Update based on your setup:
          - 'host.docker.internal:3002'  # macOS/Windows
          # - 'tcad-scraper:3002'        # Docker network
          # - '192.168.1.100:3002'       # Host IP
```

### Alert Rules

**File**: `prometheus/prometheus.rules.yml`

Defines alert conditions for:
- HTTP errors (5xx, 4xx)
- Slow responses
- Scrape failures
- Queue backlog
- Database performance
- Cache health
- Token refresh issues
- Code complexity warnings
- System resources

**Customize thresholds:**

```yaml
- alert: HighServerErrorRate
  expr: |
    (sum(rate(tcad_scraper_http_requests_total{status_code=~"5.."}[5m]))
     / sum(rate(tcad_scraper_http_requests_total[5m]))) > 0.05  # 5%
  for: 5m
```

### Grafana Datasources

**File**: `grafana/provisioning/datasources/prometheus.yml`

Auto-configures Prometheus as a datasource on Grafana startup.

### Grafana Dashboards

**Directory**: `grafana/dashboards/`

Pre-built dashboards:

1. **tcad-overview.json** - Application overview
   - HTTP metrics
   - Scraper performance
   - Queue status
   - System health

2. **code-complexity.json** - Code quality metrics
   - Cyclomatic complexity
   - Lines of code
   - File and function counts
   - Maintainability index

**Importing additional dashboards:**

1. Visit Grafana
2. Click **+ → Import**
3. Upload JSON file or paste JSON
4. Select Prometheus datasource

## Customization

### Adding New Metrics

1. **In application code**:
   ```typescript
   import { Gauge } from 'prom-client';

   const myMetric = new Gauge({
     name: 'my_custom_metric',
     help: 'Description of metric',
     registers: [register],
   });

   myMetric.set(42);
   ```

2. **In Prometheus** - metrics are auto-discovered

3. **In Grafana** - create panel with query:
   ```promql
   my_custom_metric
   ```

### Adding New Alerts

Edit `prometheus/prometheus.rules.yml`:

```yaml
- alert: MyCustomAlert
  expr: my_metric > 100
  for: 5m
  labels:
    severity: warning
  annotations:
    summary: "Custom alert triggered"
    description: "Value is {{ $value }}"
```

Reload Prometheus:
```bash
docker exec tcad-prometheus kill -HUP 1
```

### Creating New Dashboards

1. **In Grafana UI**:
   - Create and configure dashboard
   - Click **Share → Export**
   - Save JSON to `grafana/dashboards/`

2. **Provisioning** (auto-load):
   - Place JSON in `grafana/dashboards/`
   - Restart Grafana: `docker restart tcad-grafana`

## Data Retention

Prometheus retains metrics for 30 days by default.

**To change retention**:

Edit `docker-compose.monitoring.yml`:

```yaml
prometheus:
  command:
    - '--storage.tsdb.retention.time=90d'  # 90 days
```

**Storage requirements**:
- ~5GB per month for TCAD Scraper metrics
- Scale proportionally with data retention

## Troubleshooting

### No metrics showing

```bash
# Check if Prometheus can scrape metrics
curl http://localhost:3002/metrics

# Check Prometheus targets
open http://localhost:9090/targets

# View Prometheus logs
docker logs tcad-prometheus
```

### Grafana shows "No data"

1. Check datasource: Configuration → Data Sources
2. Test connection: Click "Save & Test"
3. Verify time range in dashboard
4. Check query syntax

### Alerts not firing

```bash
# Check alert rules are loaded
open http://localhost:9090/rules

# Check alert evaluation
open http://localhost:9090/alerts

# View Prometheus logs
docker logs tcad-prometheus | grep -i alert
```

## Security Notes

**For production deployments:**

1. **Change default passwords**:
   ```bash
   # Set in .env
   GRAFANA_ADMIN_PASSWORD=strong-password
   ```

2. **Enable authentication**:
   - Prometheus: Use reverse proxy with auth
   - Grafana: Enable OAuth/LDAP

3. **Restrict access**:
   ```yaml
   # Bind to localhost only
   ports:
     - "127.0.0.1:9090:9090"
   ```

4. **Use HTTPS**:
   - Deploy behind nginx/Traefik
   - Configure SSL certificates

## Backup

**Prometheus data**:
```bash
docker cp tcad-prometheus:/prometheus ./backup/prometheus-$(date +%Y%m%d)
```

**Grafana dashboards**:
- Already version-controlled in this directory
- Export from UI: Dashboard Settings → JSON Model

## Support

See main documentation:
- [MONITORING_DEPLOYMENT.md](../MONITORING_DEPLOYMENT.md) - Complete deployment guide
- [PROMETHEUS_SETUP.md](../server/PROMETHEUS_SETUP.md) - Metrics setup
- [ARCHITECTURE.md](../ARCHITECTURE.md) - System architecture

---

**Version**: 1.0
**Last Updated**: November 8, 2025
</file>

</files>
