# February 23, 2026 - Backlog Sweep

## Bug Fixes
- **BUG-1**: Flaky timing test — widened `toBeLessThan(50)` → `toBeLessThan(200)` in `timing.test.ts:56`
- **BUG-4**: Integration test TODOs — replaced 4 TODO-gated tests with `test.skipIf(!hasFrontend)`; removed misleading TODO from API 404 test

## Render Deployment
- **RENDER-1**: `isRedisAvailable` in test-utils.ts now supports `REDIS_URL` connection strings with TLS (`rediss://`)
- **RENDER-2**: `worker.ts` migrated from winston → Pino logger; `process.env.REDIS_HOST/PORT` → `config.redis`; credentials sanitized from log output
- **RENDER-3**: Added `server/Dockerfile.worker` (Node 22 Alpine + system Chromium) for Playwright-capable Background Worker on Render; commented-out `tcad-worker` service in `render.yaml`
- **RENDER-4**: Pinned Node.js to 22 LTS — `.node-version`, `engines.node` in `package.json`, `nodeVersion: "22"` in `render.yaml`

## E2E / Testing Infrastructure
- **E2E-1**: Playwright e2e test suite — 3 specs (search, property-card, error-handling) with 12 tests
- **E2E-2**: Removed 100+ lines of CSS class mocks; switched to `data-testid` + `getByRole`; added `css.modules.classNameStrategy: "non-scoped"` to vite config
- **E2E-3**: Playwright failure artifacts — `screenshot: "only-on-failure"`, `trace: "on-first-retry"`, `outputDir: "./e2e/test-results"`
- **E2E-4**: Integration test retry count: 1 → 2 (`server/vitest.integration.config.ts`)
- **E2E-5**: Unit test timeout: 10s → 5s (`server/vitest.config.ts`); 617 tests pass
- **E2E-6**: Page object pattern — `e2e/pages/SearchBoxPage.ts` and `PropertyCardPage.ts`; refactored all 3 e2e specs
- **E2E-7**: Test data factory — `server/src/__tests__/factories.ts` with `buildProperty`, `buildScrapeJobData`, `buildScrapeJobResult`
- **E2E-8**: Visual regression — `e2e/visual.spec.ts` using Playwright `toHaveScreenshot` (2% drift tolerance)
- **E2E-9**: Accessibility — `@axe-core/playwright` + `e2e/accessibility.spec.ts` (WCAG 2.1 AA)
- **E2E-10**: Load testing — `load-tests/api.k6.js` with k6 ramp stages and p95 thresholds

## Code Review Fixes
- Dockerfile.worker: Node 20 → 22, Chromium path `chromium-browser` → `chromium` (Alpine)
- `render.yaml`: added `nodeVersion: "22"` to web service
- `worker.ts`: sanitize Redis URL before logging (strip credentials)
- `test-utils.ts`: remove dead `redisOptions` variable
- `SearchBoxPage.ts`: remove unused `isSearchButtonDisabled/Enabled` methods
- `factories.ts`: tab indentation (Biome standard)
